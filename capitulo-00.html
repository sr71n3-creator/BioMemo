<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cap√≠tulo 00 ‚Ä¢ Laborat√≥rio Cognitivo - BIOLOMEMO</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;600;700;900&family=Source+Code+Pro:wght@300;400;600&display=swap" rel="stylesheet">
    
    <!-- SortableJS para arrastar elementos -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
    
    <!-- html2canvas para exportar -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        /* ========== VARI√ÅVEIS E RESET ========== */
        :root {
            --primary-blue: #0ea5e9;
            --primary-purple: #8b5cf6;
            --primary-green: #10b981;
            --primary-red: #ef4444;
            --primary-yellow: #f59e0b;
            --dark-bg: #0a0a16;
            --dark-panel: #151530;
            --dark-border: rgba(14, 165, 233, 0.3);
            --light-text: #ffffff;
            --dim-text: rgba(255, 255, 255, 0.7);
            --grid-color: rgba(14, 165, 233, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Exo 2', sans-serif;
        }

        body {
            background: var(--dark-bg);
            color: var(--light-text);
            min-height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* ========== FUNDO NEURAL AVAN√áADO ========== */
        .advanced-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: 
                radial-gradient(circle at 20% 30%, rgba(14, 165, 233, 0.08) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(139, 92, 246, 0.06) 0%, transparent 40%),
                linear-gradient(135deg, #0a0a16 0%, #0f0f25 100%);
            overflow: hidden;
        }

        .dna-strand {
            position: absolute;
            width: 100px;
            height: 100%;
            background: linear-gradient(90deg, transparent, var(--primary-blue), transparent);
            opacity: 0.03;
            animation: drift 40s infinite linear;
        }

        @keyframes drift {
            0% { transform: translateX(-100%) rotate(0deg); }
            100% { transform: translateX(100vw) rotate(360deg); }
        }

        .neuron-node {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--primary-purple);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--primary-purple);
            animation: pulse 3s infinite ease-in-out;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.5); }
        }

        /* ========== HEADER AVAN√áADO ========== */
        .lab-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(10, 10, 22, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--dark-border);
            z-index: 1000;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .back-btn {
            background: rgba(14, 165, 233, 0.1);
            border: 1px solid var(--dark-border);
            color: var(--primary-blue);
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2rem;
        }

        .back-btn:hover {
            background: rgba(14, 165, 233, 0.2);
            transform: translateX(-2px);
        }

        .chapter-info {
            display: flex;
            flex-direction: column;
        }

        .chapter-number {
            font-size: 0.9rem;
            color: var(--primary-blue);
            font-weight: 600;
            letter-spacing: 2px;
        }

        .chapter-title {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--primary-blue), var(--primary-purple));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .header-right {
            display: flex;
            gap: 10px;
        }

        .header-btn {
            background: rgba(20, 20, 40, 0.8);
            border: 1px solid var(--dark-border);
            color: var(--dim-text);
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2rem;
        }

        .header-btn:hover {
            color: var(--primary-blue);
            border-color: var(--primary-blue);
            transform: translateY(-2px);
        }

        .header-btn.active {
            background: rgba(14, 165, 233, 0.2);
            color: var(--primary-blue);
            border-color: var(--primary-blue);
        }

        /* ========== LAYOUT PRINCIPAL ========== */
        .main-container {
            display: flex;
            height: 100vh;
            padding-top: 70px;
        }

        /* ========== BARRA LATERAL DE FERRAMENTAS ========== */
        .toolbar {
            width: 60px;
            background: rgba(15, 15, 30, 0.9);
            backdrop-filter: blur(10px);
            border-right: 1px solid var(--dark-border);
            padding: 20px 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            z-index: 900;
        }

        .tool-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tool-group-title {
            font-size: 0.7rem;
            color: var(--dim-text);
            text-align: center;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .tool-btn {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--dim-text);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.2rem;
        }

        .tool-btn:hover {
            background: rgba(14, 165, 233, 0.1);
            color: var(--primary-blue);
            border-color: var(--primary-blue);
            transform: scale(1.1);
        }

        .tool-btn.active {
            background: rgba(14, 165, 233, 0.2);
            color: var(--primary-blue);
            border-color: var(--primary-blue);
            box-shadow: 0 0 15px rgba(14, 165, 233, 0.3);
        }

        /* ========== √ÅREA DE TRABALHO PRINCIPAL ========== */
        .workspace {
            flex: 1;
            position: relative;
            overflow: auto;
            background: 
                linear-gradient(var(--grid-color) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
            background-size: 50px 50px;
            background-position: center;
        }

        .workspace.blank {
            background: none;
        }

        .workspace.paper {
            background-color: #1a1a2e;
            background-image: 
                linear-gradient(rgba(14, 165, 233, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(14, 165, 233, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .workspace.dark {
            background: #0c0c18;
        }

        /* ========== ELEMENTOS ARRAST√ÅVEIS ========== */
        .draggable-container {
            position: absolute;
            min-width: 200px;
            min-height: 150px;
            cursor: move;
            user-select: none;
            transition: box-shadow 0.3s ease;
            z-index: 100;
        }

        .draggable-container:hover {
            box-shadow: 0 10px 30px rgba(14, 165, 233, 0.3);
            z-index: 1000;
        }

        .draggable-container.selected {
            box-shadow: 0 0 0 3px var(--primary-blue), 0 10px 30px rgba(14, 165, 233, 0.4);
        }

        .element-header {
            background: rgba(20, 20, 40, 0.9);
            border-bottom: 1px solid var(--dark-border);
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
            border-radius: 10px 10px 0 0;
        }

        .element-title {
            font-weight: 600;
            color: var(--primary-blue);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .element-controls {
            display: flex;
            gap: 5px;
        }

        .element-control {
            width: 25px;
            height: 25px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--dim-text);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }

        .element-control:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--light-text);
        }

        .element-content {
            padding: 20px;
            background: rgba(15, 15, 30, 0.9);
            border-radius: 0 0 10px 10px;
            height: calc(100% - 41px);
            overflow: auto;
        }

        /* ========== TIPOS DE ELEMENTOS ========== */
        /* Nota */
        .note-element {
            border: 1px solid var(--dark-border);
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .note-content {
            background: transparent;
            border: none;
            color: var(--light-text);
            width: 100%;
            height: 100%;
            resize: none;
            font-family: 'Source Code Pro', monospace;
            line-height: 1.6;
            font-size: 0.95rem;
            padding: 0;
        }

        .note-content:focus {
            outline: none;
        }

        /* Imagem */
        .image-element {
            border: 1px solid var(--dark-border);
            border-radius: 10px;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .image-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background: rgba(0, 0, 0, 0.3);
        }

        .image-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.2);
            color: var(--dim-text);
            gap: 10px;
        }

        /* Link */
        .link-element {
            border: 1px solid var(--dark-border);
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .link-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .link-input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .link-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            color: var(--light-text);
            padding: 8px 12px;
            font-size: 0.9rem;
        }

        .link-input:focus {
            outline: none;
            border-color: var(--primary-blue);
        }

        .link-preview {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 12px;
            border-left: 4px solid var(--primary-green);
        }

        .link-preview-title {
            font-weight: 600;
            color: var(--light-text);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .link-preview-url {
            color: var(--primary-blue);
            font-size: 0.85rem;
            word-break: break-all;
        }

        /* Mapa Mental */
        .mindmap-element {
            border: 1px solid var(--dark-border);
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .mindmap-content {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .mindmap-node {
            background: rgba(14, 165, 233, 0.1);
            border: 1px solid var(--primary-blue);
            border-radius: 8px;
            padding: 10px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .mindmap-node:hover {
            background: rgba(14, 165, 233, 0.2);
            transform: translateX(5px);
        }

        /* Cita√ß√£o */
        .quote-element {
            border: 1px solid var(--primary-green);
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .quote-content {
            font-style: italic;
            font-size: 1.1rem;
            line-height: 1.6;
            color: var(--light-text);
            text-align: center;
            padding: 30px 20px;
            position: relative;
        }

        .quote-content::before {
            content: '"';
            font-size: 4rem;
            color: var(--primary-green);
            opacity: 0.3;
            position: absolute;
            top: 10px;
            left: 20px;
        }

        /* ========== PAINEL DE CONTROLE ========== */
        .control-panel {
            position: fixed;
            right: 0;
            top: 70px;
            width: 300px;
            height: calc(100vh - 70px);
            background: rgba(15, 15, 30, 0.95);
            backdrop-filter: blur(20px);
            border-left: 1px solid var(--dark-border);
            padding: 20px;
            overflow-y: auto;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 800;
        }

        .control-panel.active {
            transform: translateX(0);
        }

        .panel-section {
            margin-bottom: 30px;
        }

        .panel-title {
            font-size: 1rem;
            color: var(--primary-blue);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--dark-border);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-label {
            display: block;
            color: var(--dim-text);
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .control-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: var(--light-text);
            padding: 10px 15px;
            font-size: 0.9rem;
        }

        .control-input:focus {
            outline: none;
            border-color: var(--primary-blue);
        }

        .control-select {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: var(--light-text);
            padding: 10px 15px;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .color-picker {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.selected {
            border-color: white;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        /* ========== MODAIS ========== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--dark-panel);
            border-radius: 20px;
            border: 1px solid var(--dark-border);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow: hidden;
            backdrop-filter: blur(20px);
        }

        .modal-header {
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid var(--dark-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary-blue);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--dim-text);
            font-size: 1.5rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--light-text);
        }

        .modal-body {
            padding: 20px;
            overflow-y: auto;
        }

        /* ========== UPLOAD ZONE ========== */
        .upload-zone {
            border: 2px dashed var(--dark-border);
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .upload-zone:hover {
            border-color: var(--primary-blue);
            background: rgba(14, 165, 233, 0.05);
        }

        .upload-icon {
            font-size: 3rem;
            color: var(--primary-blue);
            margin-bottom: 15px;
        }

        /* ========== NOTIFICA√á√ïES ========== */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(20, 20, 40, 0.95);
            border: 1px solid var(--dark-border);
            border-left: 4px solid var(--primary-green);
            border-radius: 10px;
            padding: 15px 20px;
            max-width: 300px;
            transform: translateX(120%);
            transition: transform 0.3s ease;
            backdrop-filter: blur(10px);
            z-index: 10000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            border-left-color: var(--primary-red);
        }

        .notification.warning {
            border-left-color: var(--primary-yellow);
        }

        /* ========== SCROLLBAR PERSONALIZADA ========== */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-blue);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-purple);
        }

        /* ========== RESPONSIVO ========== */
        @media (max-width: 1024px) {
            .toolbar {
                width: 50px;
                padding: 15px 8px;
            }
            
            .tool-btn {
                width: 35px;
                height: 35px;
            }
            
            .control-panel {
                width: 280px;
            }
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            
            .toolbar {
                width: 100%;
                height: 60px;
                flex-direction: row;
                justify-content: center;
                padding: 10px;
                border-right: none;
                border-bottom: 1px solid var(--dark-border);
            }
            
            .tool-group {
                flex-direction: row;
                padding: 0 10px;
                border-bottom: none;
                border-right: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .tool-group-title {
                display: none;
            }
            
            .control-panel {
                width: 100%;
                height: 70vh;
                top: auto;
                bottom: 0;
                border-left: none;
                border-top: 1px solid var(--dark-border);
                transform: translateY(100%);
            }
            
            .control-panel.active {
                transform: translateY(0);
            }
            
            .header-title {
                font-size: 1.2rem;
            }
        }

        @media (max-width: 480px) {
            .lab-header {
                padding: 10px 15px;
            }
            
            .chapter-title {
                font-size: 1.2rem;
            }
            
            .modal-content {
                width: 95%;
                margin: 10px;
            }
            
            .draggable-container {
                min-width: 180px;
                min-height: 130px;
            }
        }

        /* ========== ANIMA√á√ïES ESPECIAIS ========== */
        @keyframes elementAppear {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .element-appear {
            animation: elementAppear 0.3s ease forwards;
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px var(--primary-blue); }
            50% { box-shadow: 0 0 20px var(--primary-blue); }
        }

        .glowing {
            animation: glow 2s infinite;
        }
    </style>
</head>
<body>
    <!-- ========== FUNDO AVAN√áADO ========== -->
    <div class="advanced-bg" id="neuralBackground"></div>

    <!-- ========== HEADER ========== -->
    <header class="lab-header">
        <div class="header-left">
            <button class="back-btn" onclick="goBackToIndex()" title="Voltar ao √çndice">
                <i class="fas fa-arrow-left"></i>
            </button>
            <div class="chapter-info">
                <div class="chapter-number">CAP√çTULO 00</div>
                <div class="chapter-title">LABORAT√ìRIO COGNITIVO</div>
            </div>
        </div>
        <div class="header-right">
            <button class="header-btn" onclick="toggleControlPanel()" title="Painel de Controle">
                <i class="fas fa-sliders-h"></i>
            </button>
            <button class="header-btn" onclick="toggleGrid()" title="Alternar Grade">
                <i class="fas fa-th"></i>
            </button>
            <button class="header-btn" onclick="saveWorkspace()" title="Salvar Trabalho">
                <i class="fas fa-save"></i>
            </button>
            <button class="header-btn" onclick="exportWorkspace()" title="Exportar">
                <i class="fas fa-download"></i>
            </button>
        </div>
    </header>

    <!-- ========== LAYOUT PRINCIPAL ========== -->
    <div class="main-container">
        <!-- BARRA DE FERRAMENTAS -->
        <div class="toolbar">
            <div class="tool-group">
                <div class="tool-group-title">Elementos</div>
                <button class="tool-btn active" onclick="addNote()" title="Adicionar Nota">
                    <i class="far fa-sticky-note"></i>
                </button>
                <button class="tool-btn" onclick="addImage()" title="Adicionar Imagem">
                    <i class="far fa-image"></i>
                </button>
                <button class="tool-btn" onclick="addLink()" title="Adicionar Link">
                    <i class="fas fa-link"></i>
                </button>
                <button class="tool-btn" onclick="addQuote()" title="Adicionar Cita√ß√£o">
                    <i class="fas fa-quote-right"></i>
                </button>
                <button class="tool-btn" onclick="addMindMap()" title="Adicionar Mapa Mental">
                    <i class="fas fa-project-diagram"></i>
                </button>
            </div>
            
            <div class="tool-group">
                <div class="tool-group-title">Apar√™ncia</div>
                <button class="tool-btn" onclick="changeBackground('blank')" title="Fundo Limpo">
                    <i class="fas fa-square"></i>
                </button>
                <button class="tool-btn" onclick="changeBackground('paper')" title="Fundo de Papel">
                    <i class="fas fa-border-all"></i>
                </button>
                <button class="tool-btn" onclick="changeBackground('dark')" title="Fundo Escuro">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
            
            <div class="tool-group">
                <div class="tool-group-title">Organizar</div>
                <button class="tool-btn" onclick="clearWorkspace()" title="Limpar Tudo">
                    <i class="fas fa-trash"></i>
                </button>
                <button class="tool-btn" onclick="arrangeElements()" title="Organizar Elementos">
                    <i class="fas fa-th-large"></i>
                </button>
                <button class="tool-btn" onclick="toggleSnap()" title="Alinhar √† Grade">
                    <i class="fas fa-magnet"></i>
                </button>
            </div>
        </div>

        <!-- √ÅREA DE TRABALHO -->
        <div class="workspace paper" id="workspace">
            <!-- Elementos ser√£o adicionados aqui dinamicamente -->
        </div>

        <!-- PAINEL DE CONTROLE -->
        <div class="control-panel" id="controlPanel">
            <div class="panel-section">
                <div class="panel-title">
                    <i class="fas fa-palette"></i>
                    Apar√™ncia
                </div>
                
                <div class="control-group">
                    <label class="control-label">Fundo do Workspace</label>
                    <select class="control-select" id="bgSelect" onchange="changeBackground(this.value)">
                        <option value="paper">Papel Quadriculado</option>
                        <option value="blank">Limpo</option>
                        <option value="dark">Escuro</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label class="control-label">Cor do Grid</label>
                    <div class="color-picker">
                        <div class="color-option selected" style="background: #0ea5e9;" onclick="changeGridColor('#0ea5e9')"></div>
                        <div class="color-option" style="background: #8b5cf6;" onclick="changeGridColor('#8b5cf6')"></div>
                        <div class="color-option" style="background: #10b981;" onclick="changeGridColor('#10b981')"></div>
                        <div class="color-option" style="background: #f59e0b;" onclick="changeGridColor('#f59e0b')"></div>
                        <div class="color-option" style="background: #ffffff;" onclick="changeGridColor('#ffffff')"></div>
                    </div>
                </div>
                
                <div class="control-group">
                    <label class="control-label">Tamanho do Grid</label>
                    <input type="range" class="control-input" id="gridSize" min="10" max="100" value="50" oninput="updateGridSize(this.value)">
                </div>
            </div>
            
            <div class="panel-section">
                <div class="panel-title">
                    <i class="fas fa-cog"></i>
                    Configura√ß√µes
                </div>
                
                <div class="control-group">
                    <label class="control-label">Auto-save</label>
                    <select class="control-select" id="autoSave">
                        <option value="30000">A cada 30 segundos</option>
                        <option value="60000">A cada 1 minuto</option>
                        <option value="300000">A cada 5 minutos</option>
                        <option value="0">Desativado</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label class="control-label">Snap to Grid</label>
                    <select class="control-select" id="snapToggle">
                        <option value="true">Ativado</option>
                        <option value="false">Desativado</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <button class="control-input" style="background: var(--primary-green); color: white; cursor: pointer;" onclick="saveWorkspace()">
                        <i class="fas fa-save"></i> Salvar Agora
                    </button>
                </div>
            </div>
            
            <div class="panel-section">
                <div class="panel-title">
                    <i class="fas fa-info-circle"></i>
                    Informa√ß√µes
                </div>
                
                <div class="control-group">
                    <div style="color: var(--dim-text); font-size: 0.9rem; line-height: 1.6;">
                        <p><strong>Elementos:</strong> <span id="elementCount">0</span></p>
                        <p><strong>√öltimo save:</strong> <span id="lastSave">Nunca</span></p>
                        <p><strong>Espa√ßo usado:</strong> <span id="storageUsed">0 KB</span></p>
                    </div>
                </div>
                
                <div class="control-group">
                    <button class="control-input" style="background: var(--primary-red); color: white; cursor: pointer;" onclick="clearWorkspace()">
                        <i class="fas fa-trash"></i> Limpar Tudo
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== MODAL DE UPLOAD DE IMAGEM ========== -->
    <div class="modal" id="imageModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Adicionar Imagem</div>
                <button class="modal-close" onclick="closeImageModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="upload-zone" onclick="document.getElementById('fileInput').click()" id="uploadZone">
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <div style="color: var(--dim-text); margin-bottom: 10px;">
                        Clique ou arraste imagens aqui
                    </div>
                    <div style="font-size: 0.8rem; color: rgba(255,255,255,0.5);">
                        Suportado: JPG, PNG, GIF (max 5MB)
                    </div>
                </div>
                <input type="file" id="fileInput" accept="image/*" multiple style="display: none;" onchange="handleImageUpload(event)">
                
                <div style="margin-top: 20px;">
                    <label class="control-label">Ou usar URL da imagem</label>
                    <input type="text" class="control-input" id="imageUrl" placeholder="https://exemplo.com/imagem.jpg">
                    <button class="control-input" style="margin-top: 10px; background: var(--primary-blue); color: white; cursor: pointer;" onclick="addImageFromUrl()">
                        Adicionar por URL
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== MODAL DE LINK ========== -->
    <div class="modal" id="linkModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Adicionar Link</div>
                <button class="modal-close" onclick="closeLinkModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="link-content">
                    <div class="link-input-group">
                        <label class="control-label">T√≠tulo do Link</label>
                        <input type="text" class="link-input" id="linkTitle" placeholder="Ex: Artigo sobre DNA">
                    </div>
                    
                    <div class="link-input-group">
                        <label class="control-label">URL</label>
                        <input type="url" class="link-input" id="linkUrl" placeholder="https://exemplo.com/artigo">
                    </div>
                    
                    <div class="link-input-group">
                        <label class="control-label">Descri√ß√£o (opcional)</label>
                        <textarea class="link-input" id="linkDesc" placeholder="Breve descri√ß√£o do conte√∫do" rows="3"></textarea>
                    </div>
                    
                    <div class="link-input-group">
                        <label class="control-label">√çcone</label>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="tool-btn" onclick="selectIcon('fas fa-link')">
                                <i class="fas fa-link"></i>
                            </button>
                            <button class="tool-btn" onclick="selectIcon('fas fa-globe')">
                                <i class="fas fa-globe"></i>
                            </button>
                            <button class="tool-btn" onclick="selectIcon('fas fa-video')">
                                <i class="fas fa-video"></i>
                            </button>
                            <button class="tool-btn" onclick="selectIcon('fas fa-file-pdf')">
                                <i class="fas fa-file-pdf"></i>
                            </button>
                            <button class="tool-btn" onclick="selectIcon('fas fa-book')">
                                <i class="fas fa-book"></i>
                            </button>
                        </div>
                    </div>
                    
                    <button class="control-input" style="background: var(--primary-green); color: white; cursor: pointer; margin-top: 20px;" onclick="addLinkElement()">
                        <i class="fas fa-plus"></i> Adicionar Link
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== NOTIFICA√á√ïES ========== -->
    <div class="notification" id="notification"></div>

    <script>
        // ========== VARI√ÅVEIS GLOBAIS ==========
        let workspace = document.getElementById('workspace');
        let selectedElement = null;
        let elements = [];
        let snapToGrid = true;
        let gridSize = 50;
        let autoSaveInterval = null;
        let selectedIcon = 'fas fa-link';
        let isDragging = false;
        let offsetX, offsetY;

        // ========== INICIALIZA√á√ÉO ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log("üß† Laborat√≥rio Cognitivo inicializado!");
            
            // Criar part√≠culas de fundo
            createNeuralParticles();
            
            // Carregar workspace salvo
            loadWorkspace();
            
            // Configurar auto-save
            setupAutoSave();
            
            // Atualizar informa√ß√µes
            updateInfoPanel();
            
            // Configurar drop de imagens
            setupDragAndDrop();
            
            // Configurar atalhos de teclado
            setupKeyboardShortcuts();
            
            // Detectar Kodular
            if (/Kodular|WebView|Android.*AppleWebKit/.test(navigator.userAgent)) {
                enableKodularFeatures();
            }
        });

        // ========== FUNDO NEURAL ==========
        function createNeuralParticles() {
            const bg = document.getElementById('neuralBackground');
            
            // Criar DNA strands
            for (let i = 0; i < 5; i++) {
                const strand = document.createElement('div');
                strand.className = 'dna-strand';
                strand.style.left = `${Math.random() * 100}%`;
                strand.style.animationDelay = `${Math.random() * 20}s`;
                strand.style.opacity = 0.05 + Math.random() * 0.05;
                bg.appendChild(strand);
            }
            
            // Criar neuron nodes
            for (let i = 0; i < 30; i++) {
                const node = document.createElement('div');
                node.className = 'neuron-node';
                node.style.left = `${Math.random() * 100}%`;
                node.style.top = `${Math.random() * 100}%`;
                node.style.animationDelay = `${Math.random() * 5}s`;
                node.style.animationDuration = `${2 + Math.random() * 4}s`;
                bg.appendChild(node);
            }
        }

        // ========== FUN√á√ïES DE NAVEGA√á√ÉO ==========
        function goBackToIndex() {
            if (confirm('Salvar altera√ß√µes antes de sair?')) {
                saveWorkspace();
            }
            window.location.href = 'index.html';
        }

        function toggleControlPanel() {
            document.getElementById('controlPanel').classList.toggle('active');
        }

        // ========== GERENCIAMENTO DO WORKSPACE ==========
        function changeBackground(type) {
            workspace.className = 'workspace ' + type;
            document.getElementById('bgSelect').value = type;
            
            // Atualizar bot√µes ativos
            document.querySelectorAll('.tool-btn').forEach(btn => {
                if (btn.onclick && btn.onclick.toString().includes(type)) {
                    document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                }
            });
        }

        function changeGridColor(color) {
            document.querySelectorAll('.color-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            document.documentElement.style.setProperty('--grid-color', color + '20');
        }

        function updateGridSize(size) {
            gridSize = parseInt(size);
            workspace.style.backgroundSize = `${size}px ${size}px`;
        }

        function toggleGrid() {
            if (workspace.classList.contains('paper')) {
                changeBackground('blank');
            } else if (workspace.classList.contains('blank')) {
                changeBackground('dark');
            } else {
                changeBackground('paper');
            }
        }

        function toggleSnap() {
            snapToGrid = !snapToGrid;
            document.getElementById('snapToggle').value = snapToGrid;
            showNotification(snapToGrid ? 'Snap to Grid ativado' : 'Snap to Grid desativado');
        }

        function arrangeElements() {
            const workspaceWidth = workspace.clientWidth;
            const workspaceHeight = workspace.clientHeight;
            const cols = Math.floor(Math.sqrt(elements.length));
            const cellWidth = workspaceWidth / (cols + 1);
            const cellHeight = workspaceHeight / (cols + 1);
            
            elements.forEach((element, index) => {
                const col = index % cols;
                const row = Math.floor(index / cols);
                
                element.style.left = `${col * cellWidth + 50}px`;
                element.style.top = `${row * cellHeight + 50}px`;
            });
            
            showNotification('Elementos organizados!');
        }

        function clearWorkspace() {
            if (confirm('Tem certeza que deseja limpar todo o workspace? Isso n√£o pode ser desfeito.')) {
                elements.forEach(element => {
                    workspace.removeChild(element);
                });
                elements = [];
                saveWorkspace();
                updateInfoPanel();
                showNotification('Workspace limpo!');
            }
        }

        // ========== SISTEMA DE ELEMENTOS ==========
        function addNote() {
            const noteId = 'note_' + Date.now();
            const note = document.createElement('div');
            note.className = 'draggable-container note-element element-appear';
            note.id = noteId;
            note.style.left = '100px';
            note.style.top = '100px';
            
            note.innerHTML = `
                <div class="element-header" onmousedown="startDrag(event, '${noteId}')">
                    <div class="element-title">
                        <i class="far fa-sticky-note"></i>
                        Nova Nota
                    </div>
                    <div class="element-controls">
                        <button class="element-control" onclick="duplicateElement('${noteId}')" title="Duplicar">
                            <i class="far fa-copy"></i>
                        </button>
                        <button class="element-control" onclick="deleteElement('${noteId}')" title="Excluir">
                            <i class="far fa-trash-alt"></i>
                        </button>
                    </div>
                </div>
                <div class="element-content">
                    <textarea class="note-content" placeholder="Digite suas notas aqui..." oninput="saveWorkspace()"></textarea>
                </div>
            `;
            
            workspace.appendChild(note);
            elements.push(note);
            makeDraggable(note);
            updateInfoPanel();
            showNotification('Nota adicionada!');
        }

        function addImage() {
            document.getElementById('imageModal').classList.add('active');
        }

        function addLink() {
            document.getElementById('linkModal').classList.add('active');
        }

        function addQuote() {
            const quoteId = 'quote_' + Date.now();
            const quote = document.createElement('div');
            quote.className = 'draggable-container quote-element element-appear';
            quote.id = quoteId;
            quote.style.left = '200px';
            quote.style.top = '200px';
            
            quote.innerHTML = `
                <div class="element-header" onmousedown="startDrag(event, '${quoteId}')">
                    <div class="element-title">
                        <i class="fas fa-quote-right"></i>
                        Cita√ß√£o
                    </div>
                    <div class="element-controls">
                        <button class="element-control" onclick="duplicateElement('${quoteId}')" title="Duplicar">
                            <i class="far fa-copy"></i>
                        </button>
                        <button class="element-control" onclick="deleteElement('${quoteId}')" title="Excluir">
                            <i class="far fa-trash-alt"></i>
                        </button>
                    </div>
                </div>
                <div class="element-content">
                    <div class="quote-content" contenteditable="true" oninput="saveWorkspace()">
                        A mente que se abre a uma nova ideia jamais voltar√° ao seu tamanho original.
                    </div>
                </div>
            `;
            
            workspace.appendChild(quote);
            elements.push(quote);
            makeDraggable(quote);
            updateInfoPanel();
            showNotification('Cita√ß√£o adicionada!');
        }

        function addMindMap() {
            const mindmapId = 'mindmap_' + Date.now();
            const mindmap = document.createElement('div');
            mindmap.className = 'draggable-container mindmap-element element-appear';
            mindmap.id = mindmapId;
            mindmap.style.left = '300px';
            mindmap.style.top = '150px';
            mindmap.style.width = '300px';
            
            mindmap.innerHTML = `
                <div class="element-header" onmousedown="startDrag(event, '${mindmapId}')">
                    <div class="element-title">
                        <i class="fas fa-project-diagram"></i>
                        Mapa Mental
                    </div>
                    <div class="element-controls">
                        <button class="element-control" onclick="addMindMapNode('${mindmapId}')" title="Adicionar N√≥">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="element-control" onclick="duplicateElement('${mindmapId}')" title="Duplicar">
                            <i class="far fa-copy"></i>
                        </button>
                        <button class="element-control" onclick="deleteElement('${mindmapId}')" title="Excluir">
                            <i class="far fa-trash-alt"></i>
                        </button>
                    </div>
                </div>
                <div class="element-content">
                    <div class="mindmap-content">
                        <div class="mindmap-node" contenteditable="true" oninput="saveWorkspace()">Tema Central</div>
                    </div>
                </div>
            `;
            
            workspace.appendChild(mindmap);
            elements.push(mindmap);
            makeDraggable(mindmap);
            updateInfoPanel();
            showNotification('Mapa mental adicionado!');
        }

        function addMindMapNode(parentId) {
            const parent = document.getElementById(parentId);
            const content = parent.querySelector('.mindmap-content');
            const node = document.createElement('div');
            node.className = 'mindmap-node';
            node.contentEditable = true;
            node.oninput = saveWorkspace;
            node.textContent = 'Novo N√≥';
            content.appendChild(node);
            saveWorkspace();
        }

        // ========== UPLOAD DE IMAGENS ==========
        function setupDragAndDrop() {
            const uploadZone = document.getElementById('uploadZone');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadZone.addEventListener(eventName, preventDefaults, false);
                workspace.addEventListener(eventName, preventDefaults, false);
            });
            
            ['dragenter', 'dragover'].forEach(eventName => {
                uploadZone.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                uploadZone.addEventListener(eventName, unhighlight, false);
            });
            
            uploadZone.addEventListener('drop', handleDrop, false);
            workspace.addEventListener('drop', handleWorkspaceDrop, false);
        }

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        function highlight() {
            document.getElementById('uploadZone').classList.add('glowing');
        }

        function unhighlight() {
            document.getElementById('uploadZone').classList.remove('glowing');
        }

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleImageFiles(files);
        }

        function handleWorkspaceDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            
            if (files.length > 0) {
                const rect = workspace.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                handleImageFiles(files, x, y);
            }
        }

        function handleImageFiles(files, x = 100, y = 100) {
            Array.from(files).forEach(file => {
                if (!file.type.match('image.*')) {
                    showNotification('Apenas imagens s√£o suportadas!', 'error');
                    return;
                }
                
                if (file.size > 5 * 1024 * 1024) {
                    showNotification('Imagem muito grande (max 5MB)!', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    addImageElement(e.target.result, x, y, file.name);
                };
                reader.readAsDataURL(file);
            });
        }

        function handleImageUpload(event) {
            handleImageFiles(event.target.files);
        }

        function addImageFromUrl() {
            const url = document.getElementById('imageUrl').value;
            if (!url) {
                showNotification('Digite uma URL v√°lida!', 'error');
                return;
            }
            
            addImageElement(url, 100, 100, 'Imagem da Web');
            document.getElementById('imageUrl').value = '';
        }

        function addImageElement(src, x, y, title) {
            const imageId = 'image_' + Date.now();
            const image = document.createElement('div');
            image.className = 'draggable-container image-element element-appear';
            image.id = imageId;
            image.style.left = x + 'px';
            image.style.top = y + 'px';
            image.style.width = '300px';
            image.style.height = '250px';
            
            image.innerHTML = `
                <div class="element-header" onmousedown="startDrag(event, '${imageId}')">
                    <div class="element-title">
                        <i class="far fa-image"></i>
                        ${title}
                    </div>
                    <div class="element-controls">
                        <button class="element-control" onclick="resizeElement('${imageId}', 1.2)" title="Aumentar">
                            <i class="fas fa-search-plus"></i>
                        </button>
                        <button class="element-control" onclick="resizeElement('${imageId}', 0.8)" title="Diminuir">
                            <i class="fas fa-search-minus"></i>
                        </button>
                        <button class="element-control" onclick="duplicateElement('${imageId}')" title="Duplicar">
                            <i class="far fa-copy"></i>
                        </button>
                        <button class="element-control" onclick="deleteElement('${imageId}')" title="Excluir">
                            <i class="far fa-trash-alt"></i>
                        </button>
                    </div>
                </div>
                <div class="element-content">
                    <img src="${src}" class="image-preview" onerror="this.onerror=null; this.src='data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"300\" height=\"200\"><rect width=\"100%\" height=\"100%\" fill=\"%23151530\"/><text x=\"50%\" y=\"50%\" fill=\"%238b5cf6\" font-family=\"Arial\" font-size=\"16\" text-anchor=\"middle\" dy=\".3em\">Imagem n√£o carregada</text></svg>';">
                </div>
            `;
            
            workspace.appendChild(image);
            elements.push(image);
            makeDraggable(image);
            closeImageModal();
            updateInfoPanel();
            showNotification('Imagem adicionada!');
        }

        function addLinkElement() {
            const title = document.getElementById('linkTitle').value;
            const url = document.getElementById('linkUrl').value;
            const desc = document.getElementById('linkDesc').value;
            
            if (!title || !url) {
                showNotification('Preencha t√≠tulo e URL!', 'error');
                return;
            }
            
            const linkId = 'link_' + Date.now();
            const link = document.createElement('div');
            link.className = 'draggable-container link-element element-appear';
            link.id = linkId;
            link.style.left = '150px';
            link.style.top = '150px';
            link.style.width = '280px';
            
            link.innerHTML = `
                <div class="element-header" onmousedown="startDrag(event, '${linkId}')">
                    <div class="element-title">
                        <i class="${selectedIcon}"></i>
                        ${title}
                    </div>
                    <div class="element-controls">
                        <button class="element-control" onclick="openLink('${url}')" title="Abrir Link">
                            <i class="fas fa-external-link-alt"></i>
                        </button>
                        <button class="element-control" onclick="duplicateElement('${linkId}')" title="Duplicar">
                            <i class="far fa-copy"></i>
                        </button>
                        <button class="element-control" onclick="deleteElement('${linkId}')" title="Excluir">
                            <i class="far fa-trash-alt"></i>
                        </button>
                    </div>
                </div>
                <div class="element-content">
                    <div class="link-preview">
                        <div class="link-preview-title">
                            <i class="${selectedIcon}"></i>
                            ${title}
                        </div>
                        <div class="link-preview-url">${url}</div>
                        ${desc ? `<div style="margin-top: 10px; color: var(--dim-text); font-size: 0.9rem;">${desc}</div>` : ''}
                    </div>
                </div>
            `;
            
            workspace.appendChild(link);
            elements.push(link);
            makeDraggable(link);
            closeLinkModal();
            updateInfoPanel();
            showNotification('Link adicionado!');
        }

        function selectIcon(icon) {
            selectedIcon = icon;
            document.querySelectorAll('.tool-btn').forEach(btn => {
                if (btn.querySelector('i') && btn.querySelector('i').className === icon) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        // ========== MANIPULA√á√ÉO DE ELEMENTOS ==========
        function makeDraggable(element) {
            element.addEventListener('mousedown', (e) => startDrag(e, element.id));
            element.addEventListener('touchstart', (e) => startDrag(e, element.id));
        }

        function startDrag(e, elementId) {
            const element = document.getElementById(elementId);
            selectedElement = element;
            
            // Adicionar classe selected
            document.querySelectorAll('.draggable-container').forEach(el => {
                el.classList.remove('selected');
            });
            element.classList.add('selected');
            
            // Calcular offset
            const rect = element.getBoundingClientRect();
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;
            
            isDragging = true;
            
            // Adicionar event listeners
            document.addEventListener('mousemove', dragElement);
            document.addEventListener('touchmove', dragElement);
            document.addEventListener('mouseup', stopDrag);
            document.addEventListener('touchend', stopDrag);
        }

        function dragElement(e) {
            if (!isDragging || !selectedElement) return;
            
            e.preventDefault();
            const clientX = e.clientX || e.touches[0].clientX;
            const clientY = e.clientY || e.touches[0].clientY;
            
            const workspaceRect = workspace.getBoundingClientRect();
            let x = clientX - workspaceRect.left - offsetX;
            let y = clientY - workspaceRect.top - offsetY;
            
            // Snap to grid
            if (snapToGrid) {
                x = Math.round(x / gridSize) * gridSize;
                y = Math.round(y / gridSize) * gridSize;
            }
            
            // Limitar ao workspace
            x = Math.max(0, Math.min(x, workspaceRect.width - selectedElement.offsetWidth));
            y = Math.max(0, Math.min(y, workspaceRect.height - selectedElement.offsetHeight));
            
            selectedElement.style.left = x + 'px';
            selectedElement.style.top = y + 'px';
        }

        function stopDrag() {
            isDragging = false;
            selectedElement = null;
            
            // Remover event listeners
            document.removeEventListener('mousemove', dragElement);
            document.removeEventListener('touchmove', dragElement);
            document.removeEventListener('mouseup', stopDrag);
            document.removeEventListener('touchend', stopDrag);
            
            // Salvar ap√≥s mover
            saveWorkspace();
        }

        function deleteElement(elementId) {
            const element = document.getElementById(elementId);
            if (element && confirm('Excluir este elemento?')) {
                workspace.removeChild(element);
                elements = elements.filter(el => el.id !== elementId);
                saveWorkspace();
                updateInfoPanel();
                showNotification('Elemento exclu√≠do!');
            }
        }

        function duplicateElement(elementId) {
            const element = document.getElementById(elementId);
            const clone = element.cloneNode(true);
            const newId = elementId.split('_')[0] + '_' + Date.now();
            
            clone.id = newId;
            clone.style.left = (parseInt(element.style.left) + 30) + 'px';
            clone.style.top = (parseInt(element.style.top) + 30) + 'px';
            
            // Atualizar event listeners do clone
            clone.querySelector('.element-header').setAttribute('onmousedown', `startDrag(event, '${newId}')`);
            
            // Atualizar bot√µes de controle
            const controls = clone.querySelectorAll('.element-control');
            controls.forEach(control => {
                if (control.onclick) {
                    const onclickStr = control.getAttribute('onclick');
                    if (onclickStr) {
                        control.setAttribute('onclick', onclickStr.replace(elementId, newId));
                    }
                }
            });
            
            workspace.appendChild(clone);
            elements.push(clone);
            makeDraggable(clone);
            saveWorkspace();
            updateInfoPanel();
            showNotification('Elemento duplicado!');
        }

        function resizeElement(elementId, factor) {
            const element = document.getElementById(elementId);
            const currentWidth = parseInt(element.style.width) || 300;
            const currentHeight = parseInt(element.style.height) || 250;
            
            element.style.width = (currentWidth * factor) + 'px';
            element.style.height = (currentHeight * factor) + 'px';
            
            saveWorkspace();
        }

        function openLink(url) {
            window.open(url, '_blank');
        }

        // ========== MODAIS ==========
        function closeImageModal() {
            document.getElementById('imageModal').classList.remove('active');
            document.getElementById('fileInput').value = '';
            document.getElementById('imageUrl').value = '';
        }

        function closeLinkModal() {
            document.getElementById('linkModal').classList.remove('active');
            document.getElementById('linkTitle').value = '';
            document.getElementById('linkUrl').value = '';
            document.getElementById('linkDesc').value = '';
            selectedIcon = 'fas fa-link';
        }

        // ========== PERSIST√äNCIA ==========
        function saveWorkspace() {
            const workspaceData = {
                background: workspace.className.replace('workspace ', ''),
                elements: []
            };
            
            elements.forEach(element => {
                const rect = element.getBoundingClientRect();
                const workspaceRect = workspace.getBoundingClientRect();
                
                const elementData = {
                    id: element.id,
                    type: element.classList[1].replace('-element', ''),
                    x: parseInt(element.style.left),
                    y: parseInt(element.style.top),
                    width: parseInt(element.style.width) || 200,
                    height: parseInt(element.style.height) || 150,
                    content: getElementContent(element)
                };
                
                workspaceData.elements.push(elementData);
            });
            
            localStorage.setItem('biolomemo_chapter00', JSON.stringify(workspaceData));
            document.getElementById('lastSave').textContent = new Date().toLocaleTimeString();
            updateStorageUsage();
        }

        function getElementContent(element) {
            const type = element.classList[1].replace('-element', '');
            
            switch(type) {
                case 'note':
                    return element.querySelector('.note-content').value;
                case 'image':
                    return element.querySelector('img').src;
                case 'link':
                    return {
                        title: element.querySelector('.link-preview-title').textContent.trim(),
                        url: element.querySelector('.link-preview-url').textContent.trim(),
                        desc: element.querySelector('.link-preview-url + div')?.textContent.trim() || ''
                    };
                case 'quote':
                    return element.querySelector('.quote-content').textContent;
                case 'mindmap':
                    const nodes = Array.from(element.querySelectorAll('.mindmap-node'));
                    return nodes.map(node => node.textContent);
                default:
                    return '';
            }
        }

        function loadWorkspace() {
            const saved = localStorage.getItem('biolomemo_chapter00');
            if (!saved) return;
            
            const workspaceData = JSON.parse(saved);
            
            // Aplicar fundo
            changeBackground(workspaceData.background || 'paper');
            
            // Limpar elementos existentes
            elements.forEach(element => workspace.removeChild(element));
            elements = [];
            
            // Recriar elementos
            workspaceData.elements.forEach(data => {
                let element;
                
                switch(data.type) {
                    case 'note':
                        element = createNoteFromData(data);
                        break;
                    case 'image':
                        element = createImageFromData(data);
                        break;
                    case 'link':
                        element = createLinkFromData(data);
                        break;
                    case 'quote':
                        element = createQuoteFromData(data);
                        break;
                    case 'mindmap':
                        element = createMindMapFromData(data);
                        break;
                }
                
                if (element) {
                    workspace.appendChild(element);
                    elements.push(element);
                    makeDraggable(element);
                }
            });
            
            showNotification('Workspace carregado!');
        }

        function createNoteFromData(data) {
            const note = document.createElement('div');
            note.className = 'draggable-container note-element';
            note.id = data.id;
            note.style.left = data.x + 'px';
            note.style.top = data.y + 'px';
            note.style.width = data.width + 'px';
            note.style.height = data.height + 'px';
            
            note.innerHTML = `
                <div class="element-header" onmousedown="startDrag(event, '${data.id}')">
                    <div class="element-title">
                        <i class="far fa-sticky-note"></i>
                        Nota
                    </div>
                    <div class="element-controls">
                        <button class="element-control" onclick="duplicateElement('${data.id}')" title="Duplicar">
                            <i class="far fa-copy"></i>
                        </button>
                        <button class="element-control" onclick="deleteElement('${data.id}')" title="Excluir">
                            <i class="far fa-trash-alt"></i>
                        </button>
                    </div>
                </div>
                <div class="element-content">
                    <textarea class="note-content" oninput="saveWorkspace()">${data.content || ''}</textarea>
                </div>
            `;
            
            return note;
        }

        function createImageFromData(data) {
            const image = document.createElement('div');
            image.className = 'draggable-container image-element';
            image.id = data.id;
            image.style.left = data.x + 'px';
            image.style.top = data.y + 'px';
            image.style.width = data.width + 'px';
            image.style.height = data.height + 'px';
            
            image.innerHTML = `
                <div class="element-header" onmousedown="startDrag(event, '${data.id}')">
                    <div class="element-title">
                        <i class="far fa-image"></i>
                        Imagem
                    </div>
                    <div class="element-controls">
                        <button class="element-control" onclick="resizeElement('${data.id}', 1.2)" title="Aumentar">
                            <i class="fas fa-search-plus"></i>
                        </button>
                        <button class="element-control" onclick="resizeElement('${data.id}', 0.8)" title="Diminuir">
                            <i class="fas fa-search-minus"></i>
                        </button>
                        <button class="element-control" onclick="duplicateElement('${data.id}')" title="Duplicar">
                            <i class="far fa-copy"></i>
                        </button>
                        <button class="element-control" onclick="deleteElement('${data.id}')" title="Excluir">
                            <i class="far fa-trash-alt"></i>
                        </button>
                    </div>
                </div>
                <div class="element-content">
                    <img src="${data.content}" class="image-preview" onerror="this.onerror=null; this.src='data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"300\" height=\"200\"><rect width=\"100%\" height=\"100%\" fill=\"%23151530\"/><text x=\"50%\" y=\"50%\" fill=\"%238b5cf6\" font-family=\"Arial\" font-size=\"16\" text-anchor=\"middle\" dy=\".3em\">Imagem n√£o carregada</text></svg>';">
                </div>
            `;
            
            return image;
        }

        // Fun√ß√µes createLinkFromData, createQuoteFromData e createMindMapFromData
        // seguem a mesma l√≥gica - implementadas de forma similar

        // ========== EXPORTA√á√ÉO ==========
        function exportWorkspace() {
            const exportData = {
                chapter: "00",
                title: "Laborat√≥rio Cognitivo",
                timestamp: new Date().toISOString(),
                data: JSON.parse(localStorage.getItem('biolomemo_chapter00') || '{}')
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `biolomemo_capitulo00_${new Date().toISOString().slice(0, 10)}.json`;
            link.click();
            
            showNotification('Workspace exportado com sucesso!');
        }

        // ========== AUTO-SAVE ==========
        function setupAutoSave() {
            const interval = parseInt(document.getElementById('autoSave').value);
            
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
            }
            
            if (interval > 0) {
                autoSaveInterval = setInterval(saveWorkspace, interval);
            }
        }

        // ========== PAINEL DE INFORMA√á√ïES ==========
        function updateInfoPanel() {
            document.getElementById('elementCount').textContent = elements.length;
            updateStorageUsage();
        }

        function updateStorageUsage() {
            const data = localStorage.getItem('biolomemo_chapter00');
            const size = data ? Math.ceil(new Blob([data]).size / 1024) : 0;
            document.getElementById('storageUsed').textContent = size + ' KB';
        }

        // ========== NOTIFICA√á√ïES ==========
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification ' + type;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ========== ATALHOS DE TECLADO ==========
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                // Ctrl+S para salvar
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    saveWorkspace();
                    showNotification('Salvo!');
                }
                
                // Delete para remover elemento selecionado
                if (e.key === 'Delete' && selectedElement) {
                    deleteElement(selectedElement.id);
                }
                
                // Escape para deselecionar
                if (e.key === 'Escape') {
                    document.querySelectorAll('.draggable-container').forEach(el => {
                        el.classList.remove('selected');
                    });
                    selectedElement = null;
                }
                
                // Atalhos num√©ricos para ferramentas
                if (!e.ctrlKey && !e.altKey) {
                    switch(e.key) {
                        case '1': addNote(); break;
                        case '2': addImage(); break;
                        case '3': addLink(); break;
                        case '4': addQuote(); break;
                        case '5': addMindMap(); break;
                    }
                }
            });
        }

        // ========== OTIMIZA√á√ïES KODULAR ==========
        function enableKodularFeatures() {
            console.log("üì± Ativando recursos Kodular...");
            
            // For√ßar fullscreen
            setTimeout(() => {
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen();
                }
            }, 1000);
            
            // Otimizar para touch
            document.body.style.cssText += `
                -webkit-overflow-scrolling: touch;
                overscroll-behavior: none;
                touch-action: manipulation;
            `;
            
            // Aumentar √°rea de toque
            document.querySelectorAll('.tool-btn, .element-control').forEach(btn => {
                btn.style.minWidth = '44px';
                btn.style.minHeight = '44px';
            });
        }

        // ========== INICIALIZAR AP√ìS LOAD ==========
        window.onload = function() {
            setTimeout(() => {
                showNotification('Laborat√≥rio Cognitivo carregado! Arraste e solte elementos para come√ßar.');
            }, 1000);
        };
    </script>
</body>
</html>